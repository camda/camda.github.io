---
layout: post
title: 'Java开发规范那点事'
data: 2017-08-13 19:45
categories: "Java开发规范"
tag: "Java开发规范"
---

* content
{:toc}

Java开发规范
---------------------

## 集合规范

基于阿里Java开发规范

稳定性指集合每次遍历的元素次序是一定的。有序性是指遍历的结果是按某种比较规则
依次排列的。如：ArrayList 是order/unsort；HashMap 是unorder/unsort；TreeSet 是
order/sort。

【推荐】高度注意Map 类集合K/V 能不能存储null 值的情况，如下表格：
集合类 Key Value Super 说明
Hashtable 不允许为null 不允许为null Dictionary 线程安全
ConcurrentHashMap 不允许为null 不允许为null AbstractMap 线程局部安全
TreeMap 不允许为null 允许为null AbstractMap 线程不安全
HashMap 允许为null 允许为null AbstractMap 线程不安全
反例：很多同学认为ConcurrentHashMap 是可以置入null 值。在批量翻译场景中，子线程分
发时，出现置入null 值的情况，但主线程没有捕获到此异常，导致排查困难。


使用entrySet 遍历Map 类集合KV，而不是keySet 方式进行遍历。
说明：keySet 其实是遍历了2 次，一次是转为Iterator 对象，另一次是从hashMap 中取出key
所对应的value。而entrySet 只是遍历了一次就把key 和value 都放到了entry 中，效率更
高。如果是JDK8，使用Map.foreach 方法。
正例：values()返回的是V 值集合，是一个list 集合对象；keySet()返回的是K 值集合，是
一个Set 集合对象；entrySet()返回的是K-V 值组合集合。

【强制】不要在foreach 循环里进行元素的remove/add 操作。remove 元素请使用Iterator
方式，如果并发操作，需要对Iterator 对象加锁。

【强制】泛型通配符<? extends T>来接收返回的数据，此写法的泛型集合不能使用add 方法。
说明：苹果装箱后返回一个<? extends Fruits>对象，此对象就不能往里加任何水果，包括苹
果。

【强制】使用工具类Arrays.asList()把数组转换成集合时，不能使用其修改集合相关的方法，
它的add/remove/clear 方法会抛出UnsupportedOperationException 异常。
说明：asList 的返回对象是一个Arrays 内部类，并没有实现集合的修改方法。Arrays.asList
体现的是适配器模式，只是转换接口，后台的数据仍是数组。
String[] str = new String[] { "a", "b" };
List list = Arrays.asList(str);
第一种情况：list.add("c"); 运行时异常。
第二种情况：str[0]= "gujin"; 那么list.get(0)也会随之修改。

【强制】ArrayList 的subList 结果不可强转成ArrayList，否则会抛出ClassCastException
异常：java.util.RandomAccessSubList cannot be cast to java.util.ArrayList ;
说明：subList 返回的是 ArrayList 的内部类 SubList，并不是 ArrayList ，而是 ArrayList
的一个视图，对于SubList 子列表的所有操作最终会反映到原列表上。